# redis sds 学习记录 即 java 实现
github项目地址：
## redis 为啥不直接用C中的字符串？
 * 1） 常数基本的获取字符串长度
 * 2）杜绝缓冲区溢出
 * 3） 减少修改字符串长度时所需的内存重分配次数
 * 4）二进制安全
 
## 怎么常数基本的获取字符串长度
维护了一个int 的len

## 怎么实现的杜绝缓冲区溢出？
增加字符串时，会先自己进行sds 长度增加，具体看 下一个问题中的实现

## 怎么减少增加字符串长度时的内存重分配次数？
空间预分配，
分为两种情况：
* 1. 如果len < 1mb, 程序分配和len属性（增加后的）相同长度的未使用空间，此时buf的长度为2 * len；比如扩容后是13个len，此时buf.len = 26 + 1 = 27
* 2. 如果len >= 1mb,  程序给未使用空间分配1mb， 此时buf的长度= len + 1mb + 1
    
##  怎么减少字符串长度时的内存重分配次数？
惰性空间，减少的字符串长度给到free，执行sdsfree 才会真正释放给定位置的空间

